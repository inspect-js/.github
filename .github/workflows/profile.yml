name: 'update profile'

on:
  schedule:
    - cron: '*/5 * * * *'

permissions:
  contents: read

jobs:
  profile:
    name: 'generate profile contents'
    runs-on: 'ubuntu-latest'
    permissions:
      contents: write
    steps:
      - name: Harden Runner
        uses: step-security/harden-runner@v2 # v2.3.0
        with:
          disable-sudo: true
          egress-policy: block
          allowed-endpoints: >
            api.github.com:443
            github.com:443
            nodejs.org:443
            raw.githubusercontent.com:443
            registry.npmjs.org:443
      - uses: actions/checkout@v3
      - uses: ljharb/actions/node/install@main
        with:
          skip-install: true
      - run: npm install
        working-directory: ./profile
      - run: node profile/generate.mjs
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
      - uses: stefanzweifel/git-auto-commit-action@v4
        with:
          commit_message: '[profile] node profile/generate.mjs'
